import{g as Se,h as Y,N as De,i as Ce,j as Te,U as x,k as R,I as U,C as oe,l as Ie,m as le,p as ke,q as Ne,r as d,s as Le,c as L,v as Ve,x as ne,y as W,o as E,z as re,d as m,e as Z,n as V,A as l,B as ee,b as f,a as w,D,E as xe,G as Be,F as ue,H as Fe,f as ie,t as Pe,J as Oe,K as I,L as te,M as Me,O as Re,P as Ke,Q as K,R as Ue,S as We,_ as q,T as ce,V as qe,W as ae,X as se}from"./index-CTzAda25.js";import{u as He,E as ze}from"./el-text-DCZTi4PS.js";import{e as Ge,E as je}from"./echarts-sA0HdcNu.js";import{u as Je,d as Qe,c as Xe,E as Ye,b as Ze,a as et}from"./el-input-DZSTZ5L7.js";const tt=Se({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:Y(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:Y([Function,Array]),default:De},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ce.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...Te(["ariaLabel"])}),at={[x]:s=>R(s),[U]:s=>R(s),[oe]:s=>R(s),focus:s=>s instanceof FocusEvent,blur:s=>s instanceof FocusEvent,clear:()=>!0,select:s=>Ie(s)},pe="ElAutocomplete",st=le({name:pe,inheritAttrs:!1}),ot=le({...st,props:tt,emits:at,setup(s,{expose:i,emit:r}){const t=s,y=Je(),b=ke(),a=He(),n=Ne("autocomplete"),o=d(),c=d(),v=d(),k=d();let H=!1,B=!1;const h=d([]),p=d(-1),z=d(""),_=d(!1),N=d(!1),A=d(!1),C=Le(),de=L(()=>b.style),$=L(()=>(h.value.length>0||A.value)&&_.value),G=L(()=>!t.hideLoading&&A.value),fe=L(()=>o.value?Array.from(o.value.$el.querySelectorAll("input")):[]),ve=()=>{$.value&&(z.value=`${o.value.$el.offsetWidth}px`)},ge=()=>{p.value=-1},j=Qe(async e=>{if(N.value)return;const u=g=>{A.value=!1,!N.value&&(K(g)?(h.value=g,p.value=t.highlightFirstItem?0:-1):Ue(pe,"autocomplete suggestions must be an array"))};if(A.value=!0,K(t.fetchSuggestions))u(t.fetchSuggestions);else{const g=await t.fetchSuggestions(e,u);K(g)&&u(g)}},t.debounce),he=e=>{const u=!!e;if(r(U,e),r(x,e),N.value=!1,_.value||(_.value=u),!t.triggerOnFocus&&!e){N.value=!0,h.value=[];return}j(e)},me=e=>{var u;a.value||(((u=e.target)==null?void 0:u.tagName)!=="INPUT"||fe.value.includes(document.activeElement))&&(_.value=!0)},be=e=>{r(oe,e)},ye=e=>{B?B=!1:(_.value=!0,r("focus",e),t.triggerOnFocus&&!H&&j(String(t.modelValue)))},_e=e=>{setTimeout(()=>{var u;if((u=v.value)!=null&&u.isFocusInsideContent()){B=!0;return}_.value&&T(),r("blur",e)})},Ee=()=>{_.value=!1,r(x,""),r("clear")},J=async()=>{$.value&&p.value>=0&&p.value<h.value.length?F(h.value[p.value]):t.selectWhenUnmatched&&(r("select",{value:t.modelValue}),h.value=[],p.value=-1)},$e=e=>{$.value&&(e.preventDefault(),e.stopPropagation(),T())},T=()=>{_.value=!1},we=()=>{var e;(e=o.value)==null||e.focus()},Ae=()=>{var e;(e=o.value)==null||e.blur()},F=async e=>{r(U,e[t.valueKey]),r(x,e[t.valueKey]),r("select",e),h.value=[],p.value=-1},P=e=>{if(!$.value||A.value)return;if(e<0){p.value=-1;return}e>=h.value.length&&(e=h.value.length-1);const u=c.value.querySelector(`.${n.be("suggestion","wrap")}`),S=u.querySelectorAll(`.${n.be("suggestion","list")} li`)[e],O=u.scrollTop,{offsetTop:X,scrollHeight:M}=S;X+M>O+u.clientHeight&&(u.scrollTop+=M),X<O&&(u.scrollTop-=M),p.value=e,o.value.ref.setAttribute("aria-activedescendant",`${C.value}-item-${p.value}`)},Q=Ve(k,()=>{$.value&&T()});return ne(()=>{Q==null||Q()}),W(()=>{o.value.ref.setAttribute("role","textbox"),o.value.ref.setAttribute("aria-autocomplete","list"),o.value.ref.setAttribute("aria-controls","id"),o.value.ref.setAttribute("aria-activedescendant",`${C.value}-item-${p.value}`),H=o.value.ref.hasAttribute("readonly")}),i({highlightedIndex:p,activated:_,loading:A,inputRef:o,popperRef:v,suggestions:h,handleSelect:F,handleKeyEnter:J,focus:we,blur:Ae,close:T,highlight:P}),(e,u)=>(E(),re(l(Re),{ref_key:"popperRef",ref:v,visible:l($),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[l(n).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${l(n).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ve,onHide:ge},{content:m(()=>[Z("div",{ref_key:"regionRef",ref:c,class:V([l(n).b("suggestion"),l(n).is("loading",l(G))]),style:ee({[e.fitInputWidth?"width":"minWidth"]:z.value,outline:"none"}),role:"region"},[f(l(Xe),{id:l(C),tag:"ul","wrap-class":l(n).be("suggestion","wrap"),"view-class":l(n).be("suggestion","list"),role:"listbox"},{default:m(()=>[l(G)?(E(),w("li",{key:0},[D(e.$slots,"loading",{},()=>[f(l(xe),{class:V(l(n).is("loading"))},{default:m(()=>[f(l(Be))]),_:1},8,["class"])])])):(E(!0),w(ue,{key:1},Fe(h.value,(g,S)=>(E(),w("li",{id:`${l(C)}-item-${S}`,key:S,class:V({highlighted:p.value===S}),role:"option","aria-selected":p.value===S,onClick:O=>F(g)},[D(e.$slots,"default",{item:g},()=>[ie(Pe(g[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:m(()=>[Z("div",{ref_key:"listboxRef",ref:k,class:V([l(n).b(),e.$attrs.class]),style:ee(l(de)),role:"combobox","aria-haspopup":"listbox","aria-expanded":l($),"aria-owns":l(C)},[f(l(Ye),Oe({ref_key:"inputRef",ref:o},l(y),{clearable:e.clearable,disabled:l(a),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:he,onChange:be,onFocus:ye,onBlur:_e,onClear:Ee,onKeydown:[I(te(g=>P(p.value-1),["prevent"]),["up"]),I(te(g=>P(p.value+1),["prevent"]),["down"]),I(J,["enter"]),I(T,["tab"]),I($e,["esc"])],onMousedown:me}),Me({_:2},[e.$slots.prepend?{name:"prepend",fn:m(()=>[D(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:m(()=>[D(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:m(()=>[D(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:m(()=>[D(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var lt=Ke(ot,[["__file","autocomplete.vue"]]);const nt=We(lt),rt={props:{tableData:{type:Array,Required:!0}},setup(s){const{tableData:i}=ce(s);return{tableData:i}}};function ut(s,i,r,t,y,b){const a=Ze,n=et;return E(),re(n,{data:t.tableData,stripe:"",height:"220"},{default:m(()=>[f(a,{prop:"ExamDate",label:"Date"}),f(a,{prop:"Chinese",label:"语文"}),f(a,{prop:"Mathematics",label:"数学"}),f(a,{prop:"English",label:"英语"})]),_:1},8,["data"])}const it=q(rt,[["render",ut]]),ct={props:{tableData:{type:Array,required:!0}},setup(s){const i=d(null),{tableData:r}=ce(s);let t=null;const y=()=>{const b=[],a=[],n=[],o=[];r.value.forEach(v=>{b.push(v.ExamDate),a.push(v.Chinese),n.push(v.Mathematics),o.push(v.English)});const c={legend:{data:["语文","数学","英语"]},grid:{left:"1%",right:"1%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:b},yAxis:{type:"value",minInterval:5,min:"dataMin"},series:[{name:"语文",type:"line",smooth:!0,data:a},{name:"数学",type:"line",smooth:!0,data:n},{name:"英语",type:"line",smooth:!0,data:o}]};t||(t=Ge.init(i.value)),t.setOption(c)};return W(()=>{y()}),ne(()=>{t&&t.dispose()}),qe(r,b=>{y()}),{chartDom:i}}},pt={ref:"chartDom",style:{width:"100%",height:"310px"}};function dt(s,i,r,t,y,b){return E(),w("div",pt,null,512)}const ft=q(ct,[["render",dt]]),vt={components:{tablereport:it,chartreport:ft},setup(){const s=d([]),i=d([]),r=d(""),t=async()=>{try{const a=await se.get("/user");Array.isArray(a)?i.value=a:console.warn("返回的数据格式不正确。")}catch(a){console.error("获取用户列表失败:",a),alert("获取用户失败，请检查网络或稍后再试。")}},y=(a,n)=>{const o=a?i.value.filter(c=>c.uname.toLowerCase().startsWith(a.toLowerCase())):i.value;n(o)},b=async a=>{var n,o;if(!(a!=null&&a.uname)){alert("无效的选择，请重新选择。");return}try{const c=await se.get(`/exam?user=${a.uid}`);s.value=c.data&&Array.isArray(c.data)?c.data:[]}catch(c){const v=((o=(n=c.response)==null?void 0:n.data)==null?void 0:o.message)||c.message||"未知错误";alert(`获取数据失败: ${v}，请稍后再试。`)}};return W(t),{reportList:s,state:r,querySearchAsync:y,handleSelect:b}}},gt={key:0},ht={key:1,style:{"text-align":"center"}};function mt(s,i,r,t,y,b){const a=nt,n=ae("tablereport"),o=ae("chartreport"),c=je,v=ze;return E(),w(ue,null,[f(a,{modelValue:t.state,"onUpdate:modelValue":i[0]||(i[0]=k=>t.state=k),"value-key":"uname","fetch-suggestions":t.querySearchAsync,placeholder:"点击选择或直接输入姓名查询成绩",onSelect:t.handleSelect,style:{"min-width":"300px","max-width":"300px"}},null,8,["modelValue","fetch-suggestions","onSelect"]),t.reportList&&t.reportList.length?(E(),w("div",gt,[f(c,{direction:"vertical",size:"large",fill:"",style:{"min-width":"90%"}},{default:m(()=>[f(n,{tableData:t.reportList},null,8,["tableData"]),f(o,{tableData:t.reportList},null,8,["tableData"])]),_:1})])):(E(),w("div",ht,[f(v,null,{default:m(()=>i[1]||(i[1]=[ie("暂无数据")])),_:1})]))],64)}const wt=q(vt,[["render",mt]]);export{wt as default};
