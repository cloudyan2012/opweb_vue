import{g as Se,h as Y,N as De,i as Ce,j as xe,U as L,k as O,I as K,C as oe,l as Te,m as le,p as Ie,q as ke,r as f,s as Ne,c as k,v as Le,x as ne,y as U,o as $,z as re,d as m,e as Z,n as N,A as l,B as ee,b as g,a as w,D,E as Ve,G as Be,F as ue,H as Fe,f as ie,t as Pe,J as Me,K as T,L as te,M as Oe,O as Re,P as Ke,Q as R,R as Ue,S as We,_ as W,T as ce,V as ae,W as se}from"./index-CM-EV8Iz.js";import{u as qe,E as He}from"./el-text-BUPd8VHj.js";import{u as ze,d as Ge,c as je,E as Je,b as Qe,a as Xe}from"./el-input-kpfu4Mth.js";import{e as Ye}from"./echarts-DaPzqPKM.js";const Ze=Se({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:Y(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:Y([Function,Array]),default:De},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ce.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...xe(["ariaLabel"])}),et={[L]:o=>O(o),[K]:o=>O(o),[oe]:o=>O(o),focus:o=>o instanceof FocusEvent,blur:o=>o instanceof FocusEvent,clear:()=>!0,select:o=>Te(o)},pe="ElAutocomplete",tt=le({name:pe,inheritAttrs:!1}),at=le({...tt,props:Ze,emits:et,setup(o,{expose:i,emit:r}){const t=o,b=ze(),y=Ie(),a=qe(),n=ke("autocomplete"),s=f(),p=f(),d=f(),q=f();let H=!1,V=!1;const h=f([]),c=f(-1),z=f(""),_=f(!1),I=f(!1),A=f(!1),C=Ne(),de=k(()=>y.style),E=k(()=>(h.value.length>0||A.value)&&_.value),G=k(()=>!t.hideLoading&&A.value),fe=k(()=>s.value?Array.from(s.value.$el.querySelectorAll("input")):[]),ve=()=>{E.value&&(z.value=`${s.value.$el.offsetWidth}px`)},ge=()=>{c.value=-1},j=Ge(async e=>{if(I.value)return;const u=v=>{A.value=!1,!I.value&&(R(v)?(h.value=v,c.value=t.highlightFirstItem?0:-1):Ue(pe,"autocomplete suggestions must be an array"))};if(A.value=!0,R(t.fetchSuggestions))u(t.fetchSuggestions);else{const v=await t.fetchSuggestions(e,u);R(v)&&u(v)}},t.debounce),he=e=>{const u=!!e;if(r(K,e),r(L,e),I.value=!1,_.value||(_.value=u),!t.triggerOnFocus&&!e){I.value=!0,h.value=[];return}j(e)},me=e=>{var u;a.value||(((u=e.target)==null?void 0:u.tagName)!=="INPUT"||fe.value.includes(document.activeElement))&&(_.value=!0)},be=e=>{r(oe,e)},ye=e=>{V?V=!1:(_.value=!0,r("focus",e),t.triggerOnFocus&&!H&&j(String(t.modelValue)))},_e=e=>{setTimeout(()=>{var u;if((u=d.value)!=null&&u.isFocusInsideContent()){V=!0;return}_.value&&x(),r("blur",e)})},$e=()=>{_.value=!1,r(L,""),r("clear")},J=async()=>{E.value&&c.value>=0&&c.value<h.value.length?B(h.value[c.value]):t.selectWhenUnmatched&&(r("select",{value:t.modelValue}),h.value=[],c.value=-1)},Ee=e=>{E.value&&(e.preventDefault(),e.stopPropagation(),x())},x=()=>{_.value=!1},we=()=>{var e;(e=s.value)==null||e.focus()},Ae=()=>{var e;(e=s.value)==null||e.blur()},B=async e=>{r(K,e[t.valueKey]),r(L,e[t.valueKey]),r("select",e),h.value=[],c.value=-1},F=e=>{if(!E.value||A.value)return;if(e<0){c.value=-1;return}e>=h.value.length&&(e=h.value.length-1);const u=p.value.querySelector(`.${n.be("suggestion","wrap")}`),S=u.querySelectorAll(`.${n.be("suggestion","list")} li`)[e],P=u.scrollTop,{offsetTop:X,scrollHeight:M}=S;X+M>P+u.clientHeight&&(u.scrollTop+=M),X<P&&(u.scrollTop-=M),c.value=e,s.value.ref.setAttribute("aria-activedescendant",`${C.value}-item-${c.value}`)},Q=Le(q,()=>{E.value&&x()});return ne(()=>{Q==null||Q()}),U(()=>{s.value.ref.setAttribute("role","textbox"),s.value.ref.setAttribute("aria-autocomplete","list"),s.value.ref.setAttribute("aria-controls","id"),s.value.ref.setAttribute("aria-activedescendant",`${C.value}-item-${c.value}`),H=s.value.ref.hasAttribute("readonly")}),i({highlightedIndex:c,activated:_,loading:A,inputRef:s,popperRef:d,suggestions:h,handleSelect:B,handleKeyEnter:J,focus:we,blur:Ae,close:x,highlight:F}),(e,u)=>($(),re(l(Re),{ref_key:"popperRef",ref:d,visible:l(E),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[l(n).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${l(n).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ve,onHide:ge},{content:m(()=>[Z("div",{ref_key:"regionRef",ref:p,class:N([l(n).b("suggestion"),l(n).is("loading",l(G))]),style:ee({[e.fitInputWidth?"width":"minWidth"]:z.value,outline:"none"}),role:"region"},[g(l(je),{id:l(C),tag:"ul","wrap-class":l(n).be("suggestion","wrap"),"view-class":l(n).be("suggestion","list"),role:"listbox"},{default:m(()=>[l(G)?($(),w("li",{key:0},[D(e.$slots,"loading",{},()=>[g(l(Ve),{class:N(l(n).is("loading"))},{default:m(()=>[g(l(Be))]),_:1},8,["class"])])])):($(!0),w(ue,{key:1},Fe(h.value,(v,S)=>($(),w("li",{id:`${l(C)}-item-${S}`,key:S,class:N({highlighted:c.value===S}),role:"option","aria-selected":c.value===S,onClick:P=>B(v)},[D(e.$slots,"default",{item:v},()=>[ie(Pe(v[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:m(()=>[Z("div",{ref_key:"listboxRef",ref:q,class:N([l(n).b(),e.$attrs.class]),style:ee(l(de)),role:"combobox","aria-haspopup":"listbox","aria-expanded":l(E),"aria-owns":l(C)},[g(l(Je),Me({ref_key:"inputRef",ref:s},l(b),{clearable:e.clearable,disabled:l(a),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:he,onChange:be,onFocus:ye,onBlur:_e,onClear:$e,onKeydown:[T(te(v=>F(c.value-1),["prevent"]),["up"]),T(te(v=>F(c.value+1),["prevent"]),["down"]),T(J,["enter"]),T(x,["tab"]),T(Ee,["esc"])],onMousedown:me}),Oe({_:2},[e.$slots.prepend?{name:"prepend",fn:m(()=>[D(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:m(()=>[D(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:m(()=>[D(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:m(()=>[D(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var st=Ke(at,[["__file","autocomplete.vue"]]);const ot=We(st),lt={props:{tableData:{type:Array,Required:!0}},setup(o){const{tableData:i}=ce(o);return{tableData:i}}};function nt(o,i,r,t,b,y){const a=Qe,n=Xe;return $(),re(n,{data:t.tableData,height:"300",stripe:"",style:{"max-width":"1000px"}},{default:m(()=>[g(a,{prop:"ExamDate",label:"Date"}),g(a,{prop:"Chinese",label:"语文"}),g(a,{prop:"Mathematics",label:"数学"}),g(a,{prop:"English",label:"英语"})]),_:1},8,["data"])}const rt=W(lt,[["render",nt]]),ut={props:{tableData:{type:Array,required:!0}},setup(o){const i=f(null),{tableData:r}=ce(o),t=[],b=[],y=[],a=[];r.value.forEach(d=>{t.push(d.ExamDate),b.push(d.Chinese),y.push(d.Mathematics),a.push(d.English)});const n={tooltip:{trigger:"axis"},legend:{data:["语文","数学","英语"]},grid:{left:"1%",right:"1%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:t},yAxis:{type:"value",minInterval:5,min:"dataMin"},series:[{name:"语文",type:"line",smooth:!0,data:b},{name:"数学",type:"line",smooth:!0,data:y},{name:"英语",type:"line",smooth:!0,data:a}]};let s=null;const p=()=>{try{s=Ye.init(i.value),s.setOption(n)}catch(d){console.error("图表初始化失败:",d)}};return U(()=>{p()}),ne(()=>{s&&s.dispose()}),{chartDom:i}}},it={ref:"chartDom",style:{"max-width":"1000px",height:"500px"}};function ct(o,i,r,t,b,y){return $(),w("div",it,null,512)}const pt=W(ut,[["render",ct]]),dt={components:{tablereport:rt,chartreport:pt},setup(){const o=f([]),i=f([]),r=f(""),t=async()=>{try{const a=await se.get("/user");Array.isArray(a)?i.value=a:console.warn("返回的数据格式不正确。")}catch(a){console.error("获取用户列表失败:",a),alert("获取用户失败，请检查网络或稍后再试。")}},b=(a,n)=>{const s=a?i.value.filter(p=>p.uname.toLowerCase().startsWith(a.toLowerCase())):i.value;n(s)},y=async a=>{var n,s;if(!(a!=null&&a.uname)){alert("无效的选择，请重新选择。");return}try{const p=await se.get(`/exam?user=${a.uid}`);o.value=p.data&&Array.isArray(p.data)?p.data:[]}catch(p){const d=((s=(n=p.response)==null?void 0:n.data)==null?void 0:s.message)||p.message||"未知错误";alert(`获取数据失败: ${d}，请稍后再试。`)}};return U(t),{reportList:o,state:r,querySearchAsync:b,handleSelect:y}}},ft={key:0},vt={key:1,style:{"text-align":"center"}};function gt(o,i,r,t,b,y){const a=ot,n=ae("tablereport"),s=ae("chartreport"),p=He;return $(),w(ue,null,[g(a,{modelValue:t.state,"onUpdate:modelValue":i[0]||(i[0]=d=>t.state=d),"value-key":"uname","fetch-suggestions":t.querySearchAsync,placeholder:"点击选择或直接输入姓名查询成绩",onSelect:t.handleSelect,style:{"min-width":"300px","max-width":"300px"}},null,8,["modelValue","fetch-suggestions","onSelect"]),t.reportList&&t.reportList.length?($(),w("div",ft,[g(n,{tableData:t.reportList},null,8,["tableData"]),g(s,{tableData:t.reportList},null,8,["tableData"])])):($(),w("div",vt,[g(p,null,{default:m(()=>i[1]||(i[1]=[ie("暂无数据")])),_:1})]))],64)}const $t=W(dt,[["render",gt]]);export{$t as default};
