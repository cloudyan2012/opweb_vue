import{g as ye,h as X,N as we,i as Ee,j as $e,U as V,k as M,I as U,C as te,l as Se,m as ae,p as Ae,q as Ce,r as p,s as _e,c as N,v as Te,x as ke,y as se,o as _,z as Ie,d as m,e as W,n as B,A as t,B as Y,b as g,a as D,D as $,E as Ne,G as Be,F as le,H as Ve,f as De,t as Fe,J as Le,K as C,L as Z,M as Pe,O as Oe,P as Ke,Q as R,R as Me,S as Re,_ as Ue,T as ee}from"./index-D1UifVoD.js";import{u as We,d as qe,c as He,E as xe,a as ze,b as Ge}from"./el-input-BN7fpgKN.js";import"./echarts-BwIKWejU.js";import{u as je}from"./use-form-item-NT027ZTN.js";const Qe=ye({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:X(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:X([Function,Array]),default:we},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ee.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...$e(["ariaLabel"])}),Je={[V]:o=>M(o),[U]:o=>M(o),[te]:o=>M(o),focus:o=>o instanceof FocusEvent,blur:o=>o instanceof FocusEvent,clear:()=>!0,select:o=>Se(o)},oe="ElAutocomplete",Xe=ae({name:oe,inheritAttrs:!1}),Ye=ae({...Xe,props:Qe,emits:Je,setup(o,{expose:v,emit:i}){const a=o,T=We(),k=Ae(),r=je(),s=Ce("autocomplete"),l=p(),c=p(),b=p(),q=p();let H=!1,F=!1;const f=p([]),u=p(-1),x=p(""),h=p(!1),I=p(!1),w=p(!1),S=_e(),ne=N(()=>k.style),y=N(()=>(f.value.length>0||w.value)&&h.value),z=N(()=>!a.hideLoading&&w.value),re=N(()=>l.value?Array.from(l.value.$el.querySelectorAll("input")):[]),ue=()=>{y.value&&(x.value=`${l.value.$el.offsetWidth}px`)},ie=()=>{u.value=-1},G=qe(async e=>{if(I.value)return;const n=d=>{w.value=!1,!I.value&&(R(d)?(f.value=d,u.value=a.highlightFirstItem?0:-1):Me(oe,"autocomplete suggestions must be an array"))};if(w.value=!0,R(a.fetchSuggestions))n(a.fetchSuggestions);else{const d=await a.fetchSuggestions(e,n);R(d)&&n(d)}},a.debounce),ce=e=>{const n=!!e;if(i(U,e),i(V,e),I.value=!1,h.value||(h.value=n),!a.triggerOnFocus&&!e){I.value=!0,f.value=[];return}G(e)},pe=e=>{var n;r.value||(((n=e.target)==null?void 0:n.tagName)!=="INPUT"||re.value.includes(document.activeElement))&&(h.value=!0)},de=e=>{i(te,e)},fe=e=>{F?F=!1:(h.value=!0,i("focus",e),a.triggerOnFocus&&!H&&G(String(a.modelValue)))},ve=e=>{setTimeout(()=>{var n;if((n=b.value)!=null&&n.isFocusInsideContent()){F=!0;return}h.value&&A(),i("blur",e)})},ge=()=>{h.value=!1,i(V,""),i("clear")},j=async()=>{y.value&&u.value>=0&&u.value<f.value.length?L(f.value[u.value]):a.selectWhenUnmatched&&(i("select",{value:a.modelValue}),f.value=[],u.value=-1)},he=e=>{y.value&&(e.preventDefault(),e.stopPropagation(),A())},A=()=>{h.value=!1},me=()=>{var e;(e=l.value)==null||e.focus()},be=()=>{var e;(e=l.value)==null||e.blur()},L=async e=>{i(U,e[a.valueKey]),i(V,e[a.valueKey]),i("select",e),f.value=[],u.value=-1},P=e=>{if(!y.value||w.value)return;if(e<0){u.value=-1;return}e>=f.value.length&&(e=f.value.length-1);const n=c.value.querySelector(`.${s.be("suggestion","wrap")}`),E=n.querySelectorAll(`.${s.be("suggestion","list")} li`)[e],O=n.scrollTop,{offsetTop:J,scrollHeight:K}=E;J+K>O+n.clientHeight&&(n.scrollTop+=K),J<O&&(n.scrollTop-=K),u.value=e,l.value.ref.setAttribute("aria-activedescendant",`${S.value}-item-${u.value}`)},Q=Te(q,()=>{y.value&&A()});return ke(()=>{Q==null||Q()}),se(()=>{l.value.ref.setAttribute("role","textbox"),l.value.ref.setAttribute("aria-autocomplete","list"),l.value.ref.setAttribute("aria-controls","id"),l.value.ref.setAttribute("aria-activedescendant",`${S.value}-item-${u.value}`),H=l.value.ref.hasAttribute("readonly")}),v({highlightedIndex:u,activated:h,loading:w,inputRef:l,popperRef:b,suggestions:f,handleSelect:L,handleKeyEnter:j,focus:me,blur:be,close:A,highlight:P}),(e,n)=>(_(),Ie(t(Oe),{ref_key:"popperRef",ref:b,visible:t(y),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(s).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(s).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ue,onHide:ie},{content:m(()=>[W("div",{ref_key:"regionRef",ref:c,class:B([t(s).b("suggestion"),t(s).is("loading",t(z))]),style:Y({[e.fitInputWidth?"width":"minWidth"]:x.value,outline:"none"}),role:"region"},[g(t(He),{id:t(S),tag:"ul","wrap-class":t(s).be("suggestion","wrap"),"view-class":t(s).be("suggestion","list"),role:"listbox"},{default:m(()=>[t(z)?(_(),D("li",{key:0},[$(e.$slots,"loading",{},()=>[g(t(Ne),{class:B(t(s).is("loading"))},{default:m(()=>[g(t(Be))]),_:1},8,["class"])])])):(_(!0),D(le,{key:1},Ve(f.value,(d,E)=>(_(),D("li",{id:`${t(S)}-item-${E}`,key:E,class:B({highlighted:u.value===E}),role:"option","aria-selected":u.value===E,onClick:O=>L(d)},[$(e.$slots,"default",{item:d},()=>[De(Fe(d[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:m(()=>[W("div",{ref_key:"listboxRef",ref:q,class:B([t(s).b(),e.$attrs.class]),style:Y(t(ne)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(y),"aria-owns":t(S)},[g(t(xe),Le({ref_key:"inputRef",ref:l},t(T),{clearable:e.clearable,disabled:t(r),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ce,onChange:de,onFocus:fe,onBlur:ve,onClear:ge,onKeydown:[C(Z(d=>P(u.value-1),["prevent"]),["up"]),C(Z(d=>P(u.value+1),["prevent"]),["down"]),C(j,["enter"]),C(A,["tab"]),C(he,["esc"])],onMousedown:pe}),Pe({_:2},[e.$slots.prepend?{name:"prepend",fn:m(()=>[$(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:m(()=>[$(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:m(()=>[$(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:m(()=>[$(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Ze=Ke(Ye,[["__file","autocomplete.vue"]]);const et=Re(Ze),tt={setup(){const o=p([]),v=p([]),i=p(""),a=async()=>{try{const r=await ee.get("/user");Array.isArray(r)?v.value=r:console.warn("返回的数据格式不正确。")}catch(r){console.error("获取链接失败:",r)}},T=(r,s)=>{if(!r){s(v.value);return}const l=r.toLowerCase(),c=v.value.filter(b=>b.name.toLowerCase().startsWith(l));s(c)},k=async r=>{var s,l;if(!r||!r.uname){alert("无效的选择，请重新选择。");return}try{const c=await ee.get(`/exam?user=${r.uid}`);o.value=c.data||[]}catch(c){const b=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||c.message||"未知错误";alert(`获取数据失败: ${b}，请稍后再试。`)}};return se(a),{reportList:o,state:i,querySearchAsync:T,handleSelect:k}}};function at(o,v,i,a,T,k){const r=et,s=Ge,l=ze;return _(),D(le,null,[g(r,{modelValue:a.state,"onUpdate:modelValue":v[0]||(v[0]=c=>a.state=c),"value-key":"uname","fetch-suggestions":a.querySearchAsync,placeholder:"点击选择或直接输入姓名查询成绩",onSelect:a.handleSelect,style:{"min-width":"300px","max-width":"300px"}},null,8,["modelValue","fetch-suggestions","onSelect"]),g(l,{data:a.reportList,height:"300",stripe:"",style:{"max-width":"1000px"}},{default:m(()=>[g(s,{prop:"ExamDate",label:"Date"}),g(s,{prop:"Chinese",label:"语文"}),g(s,{prop:"Mathematics",label:"数学"}),g(s,{prop:"English",label:"英语"})]),_:1},8,["data"]),W("button",{onClick:v[1]||(v[1]=(...c)=>o.drawLineChart&&o.drawLineChart(...c))},"绘制折线图")],64)}const ut=Ue(tt,[["render",at]]);export{ut as default};
