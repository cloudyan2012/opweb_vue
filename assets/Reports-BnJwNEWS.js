import{g as ye,h as J,N as we,i as Ee,j as Se,U as N,k as M,I as U,C as te,l as $e,m as ae,p as Ae,q as _e,r as c,s as Ce,c as k,v as Te,x as ke,y as se,o as C,z as Ie,d as h,e as X,n as I,A as t,B as Y,b as v,a as B,D as S,E as Ne,G as Be,F as le,H as Ve,f as De,t as Fe,J as Pe,K as _,L as Z,M as Le,O as Oe,P as Ke,Q as R,R as Me,S as Re,_ as Ue,T as ee}from"./index-DpA8RrmC.js";import{u as We,d as qe,c as xe,E as He,a as ze,b as Ge}from"./el-input-B1JyYyRB.js";import{u as je}from"./use-form-item-CnYrk_ZI.js";const Qe=ye({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:J(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:J([Function,Array]),default:we},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ee.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...Se(["ariaLabel"])}),Je={[N]:n=>M(n),[U]:n=>M(n),[te]:n=>M(n),focus:n=>n instanceof FocusEvent,blur:n=>n instanceof FocusEvent,clear:()=>!0,select:n=>$e(n)},oe="ElAutocomplete",Xe=ae({name:oe,inheritAttrs:!1}),Ye=ae({...Xe,props:Qe,emits:Je,setup(n,{expose:y,emit:i}){const s=n,V=We(),D=Ae(),r=je(),a=_e("autocomplete"),l=c(),d=c(),m=c(),W=c();let q=!1,F=!1;const f=c([]),u=c(-1),x=c(""),g=c(!1),T=c(!1),w=c(!1),$=Ce(),ne=k(()=>D.style),b=k(()=>(f.value.length>0||w.value)&&g.value),H=k(()=>!s.hideLoading&&w.value),re=k(()=>l.value?Array.from(l.value.$el.querySelectorAll("input")):[]),ue=()=>{b.value&&(x.value=`${l.value.$el.offsetWidth}px`)},ie=()=>{u.value=-1},z=qe(async e=>{if(T.value)return;const o=p=>{w.value=!1,!T.value&&(R(p)?(f.value=p,u.value=s.highlightFirstItem?0:-1):Me(oe,"autocomplete suggestions must be an array"))};if(w.value=!0,R(s.fetchSuggestions))o(s.fetchSuggestions);else{const p=await s.fetchSuggestions(e,o);R(p)&&o(p)}},s.debounce),ce=e=>{const o=!!e;if(i(U,e),i(N,e),T.value=!1,g.value||(g.value=o),!s.triggerOnFocus&&!e){T.value=!0,f.value=[];return}z(e)},pe=e=>{var o;r.value||(((o=e.target)==null?void 0:o.tagName)!=="INPUT"||re.value.includes(document.activeElement))&&(g.value=!0)},de=e=>{i(te,e)},fe=e=>{F?F=!1:(g.value=!0,i("focus",e),s.triggerOnFocus&&!q&&z(String(s.modelValue)))},ve=e=>{setTimeout(()=>{var o;if((o=m.value)!=null&&o.isFocusInsideContent()){F=!0;return}g.value&&A(),i("blur",e)})},ge=()=>{g.value=!1,i(N,""),i("clear")},G=async()=>{b.value&&u.value>=0&&u.value<f.value.length?P(f.value[u.value]):s.selectWhenUnmatched&&(i("select",{value:s.modelValue}),f.value=[],u.value=-1)},he=e=>{b.value&&(e.preventDefault(),e.stopPropagation(),A())},A=()=>{g.value=!1},me=()=>{var e;(e=l.value)==null||e.focus()},be=()=>{var e;(e=l.value)==null||e.blur()},P=async e=>{i(U,e[s.valueKey]),i(N,e[s.valueKey]),i("select",e),f.value=[],u.value=-1},L=e=>{if(!b.value||w.value)return;if(e<0){u.value=-1;return}e>=f.value.length&&(e=f.value.length-1);const o=d.value.querySelector(`.${a.be("suggestion","wrap")}`),E=o.querySelectorAll(`.${a.be("suggestion","list")} li`)[e],O=o.scrollTop,{offsetTop:Q,scrollHeight:K}=E;Q+K>O+o.clientHeight&&(o.scrollTop+=K),Q<O&&(o.scrollTop-=K),u.value=e,l.value.ref.setAttribute("aria-activedescendant",`${$.value}-item-${u.value}`)},j=Te(W,()=>{b.value&&A()});return ke(()=>{j==null||j()}),se(()=>{l.value.ref.setAttribute("role","textbox"),l.value.ref.setAttribute("aria-autocomplete","list"),l.value.ref.setAttribute("aria-controls","id"),l.value.ref.setAttribute("aria-activedescendant",`${$.value}-item-${u.value}`),q=l.value.ref.hasAttribute("readonly")}),y({highlightedIndex:u,activated:g,loading:w,inputRef:l,popperRef:m,suggestions:f,handleSelect:P,handleKeyEnter:G,focus:me,blur:be,close:A,highlight:L}),(e,o)=>(C(),Ie(t(Oe),{ref_key:"popperRef",ref:m,visible:t(b),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(a).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(a).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ue,onHide:ie},{content:h(()=>[X("div",{ref_key:"regionRef",ref:d,class:I([t(a).b("suggestion"),t(a).is("loading",t(H))]),style:Y({[e.fitInputWidth?"width":"minWidth"]:x.value,outline:"none"}),role:"region"},[v(t(xe),{id:t($),tag:"ul","wrap-class":t(a).be("suggestion","wrap"),"view-class":t(a).be("suggestion","list"),role:"listbox"},{default:h(()=>[t(H)?(C(),B("li",{key:0},[S(e.$slots,"loading",{},()=>[v(t(Ne),{class:I(t(a).is("loading"))},{default:h(()=>[v(t(Be))]),_:1},8,["class"])])])):(C(!0),B(le,{key:1},Ve(f.value,(p,E)=>(C(),B("li",{id:`${t($)}-item-${E}`,key:E,class:I({highlighted:u.value===E}),role:"option","aria-selected":u.value===E,onClick:O=>P(p)},[S(e.$slots,"default",{item:p},()=>[De(Fe(p[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:h(()=>[X("div",{ref_key:"listboxRef",ref:W,class:I([t(a).b(),e.$attrs.class]),style:Y(t(ne)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(b),"aria-owns":t($)},[v(t(He),Pe({ref_key:"inputRef",ref:l},t(V),{clearable:e.clearable,disabled:t(r),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ce,onChange:de,onFocus:fe,onBlur:ve,onClear:ge,onKeydown:[_(Z(p=>L(u.value-1),["prevent"]),["up"]),_(Z(p=>L(u.value+1),["prevent"]),["down"]),_(G,["enter"]),_(A,["tab"]),_(he,["esc"])],onMousedown:pe}),Le({_:2},[e.$slots.prepend?{name:"prepend",fn:h(()=>[S(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:h(()=>[S(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:h(()=>[S(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:h(()=>[S(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Ze=Ke(Ye,[["__file","autocomplete.vue"]]);const et=Re(Ze),tt={setup(){const n=c([]),y=c([]),i=c("");return se(async()=>{try{const r=await ee.get("/user");Array.isArray(r)?y.value=r:console.warn("返回的数据格式不正确。")}catch(r){console.error("获取链接失败:",r)}}),{reportList:n,state:i,querySearchAsync:(r,a)=>{if(!r){a(links.value);return}const l=r.toLowerCase(),d=links.value.filter(m=>m.value.toLowerCase().startsWith(l));a(d)},handleSelect:async r=>{var a,l;if(!r||!r.uname){alert("无效的选择，请重新选择。");return}try{const d=await ee.get(`/exam?user=${r.uid}`);n.value=d.data||[]}catch(d){const m=((l=(a=d.response)==null?void 0:a.data)==null?void 0:l.message)||d.message||"未知错误";alert(`获取数据失败: ${m}，请稍后再试。`)}}}}};function at(n,y,i,s,V,D){const r=et,a=Ge,l=ze;return C(),B(le,null,[v(r,{modelValue:s.state,"onUpdate:modelValue":y[0]||(y[0]=d=>s.state=d),"value-key":"uname","fetch-suggestions":s.querySearchAsync,placeholder:"点击选择或直接输入姓名查询成绩",onSelect:s.handleSelect,style:{"min-width":"300px","max-width":"300px"}},null,8,["modelValue","fetch-suggestions","onSelect"]),v(l,{data:s.reportList,height:"300",stripe:"",style:{"max-width":"1000px"}},{default:h(()=>[v(a,{prop:"ExamDate",label:"Date"}),v(a,{prop:"Chinese",label:"语文"}),v(a,{prop:"Mathematics",label:"数学"}),v(a,{prop:"English",label:"英语"})]),_:1},8,["data"])],64)}const rt=Ue(tt,[["render",at]]);export{rt as default};
