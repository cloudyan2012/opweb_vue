import{b6 as J,ag as F,h as Ke,K as _e,b2 as Y,U as M,C as Me,bd as ce,Y as qe,B as de,_ as ze,k as Q,L as Ue,u as We,I as b,aM as He,l as P,W as je,X as $e,a7 as X,n as Z,o as C,w as x,p as pe,t as g,z as fe,s as R,v as $,J as Ge,ai as B,y as ve,aS as Ye,r as T,m as S,E as Je,bo as Qe,a8 as we,a9 as Xe,aa as xe,$ as Ze,a0 as et,f as G,aF as tt,A as at,au as st,bp as lt,aU as ee,bq as ot,av as N,ab as Ce,ao as nt,T as rt,aK as z,aG as ut,a2 as Ae,a6 as V,aI as ge,aE as it,br as ct,bk as te,Q as dt,be as me,bl as be}from"./index-CH7aoHZO.js";import{E as pt}from"./el-text-Bl04x5vM.js";import{e as ft,E as vt}from"./echarts-DPAFEMjh.js";import{u as gt,t as mt,E as bt,v as ht,z as yt,A as _t}from"./el-table-column-BTrAJZDo.js";import{c as $t}from"./index-B1W2DvJ6.js";const wt=Ke({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:de(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:de([Function,Array]),default:qe},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:ce.teleported,appendTo:ce.appendTo,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...Me(["ariaLabel"])}),xt={[M]:t=>F(t),[Y]:t=>F(t),[_e]:t=>F(t),focus:t=>t instanceof FocusEvent,blur:t=>t instanceof FocusEvent,clear:()=>!0,select:t=>J(t)},Ee="ElAutocomplete",Ct=Q({name:Ee,inheritAttrs:!1}),At=Q({...Ct,props:wt,emits:xt,setup(t,{expose:e,emit:s}){const l=t,o=gt(),r=Ue(),p=$t(),n=We("autocomplete"),i=b(),f=b(),d=b(),h=b();let y=!1,u=!1;const v=b([]),c=b(-1),O=b(""),w=b(!1),k=b(!1),A=b(!1),I=He(),Se=P(()=>r.style),E=P(()=>(v.value.length>0||A.value)&&w.value),le=P(()=>!l.hideLoading&&A.value),ke=P(()=>i.value?Array.from(i.value.$el.querySelectorAll("input")):[]),Le=()=>{E.value&&(O.value=`${i.value.$el.offsetWidth}px`)},Te=()=>{c.value=-1},oe=async a=>{if(k.value)return;const m=_=>{A.value=!1,!k.value&&(G(_)?(v.value=_,c.value=l.highlightFirstItem?0:-1):tt(Ee,"autocomplete suggestions must be an array"))};if(A.value=!0,G(l.fetchSuggestions))m(l.fetchSuggestions);else{const _=await l.fetchSuggestions(a,m);G(_)&&m(_)}},ne=mt(oe,l.debounce),Ie=a=>{const m=!!a;if(s(Y,a),s(M,a),k.value=!1,w.value||(w.value=m),!l.triggerOnFocus&&!a){k.value=!0,v.value=[];return}ne(a)},De=a=>{var m;p.value||(((m=a.target)==null?void 0:m.tagName)!=="INPUT"||ke.value.includes(document.activeElement))&&(w.value=!0)},Be=a=>{s(_e,a)},Ne=a=>{var m;if(u)u=!1;else{w.value=!0,s("focus",a);const _=(m=l.modelValue)!=null?m:"";l.triggerOnFocus&&!y&&ne(String(_))}},Ve=a=>{setTimeout(()=>{var m;if((m=d.value)!=null&&m.isFocusInsideContent()){u=!0;return}w.value&&D(),s("blur",a)})},Pe=()=>{w.value=!1,s(M,""),s("clear")},re=async()=>{E.value&&c.value>=0&&c.value<v.value.length?U(v.value[c.value]):l.selectWhenUnmatched&&(s("select",{value:l.modelValue}),v.value=[],c.value=-1)},Fe=a=>{E.value&&(a.preventDefault(),a.stopPropagation(),D())},D=()=>{w.value=!1},Oe=()=>{var a;(a=i.value)==null||a.focus()},Re=()=>{var a;(a=i.value)==null||a.blur()},U=async a=>{s(Y,a[l.valueKey]),s(M,a[l.valueKey]),s("select",a),v.value=[],c.value=-1},W=a=>{if(!E.value||A.value)return;if(a<0){c.value=-1;return}a>=v.value.length&&(a=v.value.length-1);const m=f.value.querySelector(`.${n.be("suggestion","wrap")}`),L=m.querySelectorAll(`.${n.be("suggestion","list")} li`)[a],H=m.scrollTop,{offsetTop:ie,scrollHeight:j}=L;ie+j>H+m.clientHeight&&(m.scrollTop+=j),ie<H&&(m.scrollTop-=j),c.value=a,i.value.ref.setAttribute("aria-activedescendant",`${I.value}-item-${c.value}`)},ue=je(h,()=>{var a;(a=d.value)!=null&&a.isFocusInsideContent()||E.value&&D()});return $e(()=>{ue==null||ue()}),X(()=>{i.value.ref.setAttribute("role","textbox"),i.value.ref.setAttribute("aria-autocomplete","list"),i.value.ref.setAttribute("aria-controls","id"),i.value.ref.setAttribute("aria-activedescendant",`${I.value}-item-${c.value}`),y=i.value.ref.hasAttribute("readonly")}),e({highlightedIndex:c,activated:w,loading:A,inputRef:i,popperRef:d,suggestions:v,handleSelect:U,handleKeyEnter:re,focus:Oe,blur:Re,close:D,highlight:W,getData:oe}),(a,m)=>(C(),Z(g(et),{ref_key:"popperRef",ref:d,visible:g(E),placement:a.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[g(n).e("popper"),a.popperClass],teleported:a.teleported,"append-to":a.appendTo,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${g(n).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:Le,onHide:Te},{content:x(()=>[pe("div",{ref_key:"regionRef",ref:f,class:R([g(n).b("suggestion"),g(n).is("loading",g(le))]),style:fe({[a.fitInputWidth?"width":"minWidth"]:O.value,outline:"none"}),role:"region"},[$(g(ht),{id:g(I),tag:"ul","wrap-class":g(n).be("suggestion","wrap"),"view-class":g(n).be("suggestion","list"),role:"listbox"},{default:x(()=>[g(le)?(C(),S("li",{key:0},[T(a.$slots,"loading",{},()=>[$(g(Je),{class:R(g(n).is("loading"))},{default:x(()=>[$(g(Qe))]),_:1},8,["class"])])])):(C(!0),S(we,{key:1},Xe(v.value,(_,L)=>(C(),S("li",{id:`${g(I)}-item-${L}`,key:L,class:R({highlighted:c.value===L}),role:"option","aria-selected":c.value===L,onClick:H=>U(_)},[T(a.$slots,"default",{item:_},()=>[xe(Ze(_[a.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:x(()=>[pe("div",{ref_key:"listboxRef",ref:h,class:R([g(n).b(),a.$attrs.class]),style:fe(g(Se)),role:"combobox","aria-haspopup":"listbox","aria-expanded":g(E),"aria-owns":g(I)},[$(g(bt),Ge({ref_key:"inputRef",ref:i},g(o),{clearable:a.clearable,disabled:g(p),name:a.name,"model-value":a.modelValue,"aria-label":a.ariaLabel,onInput:Ie,onChange:Be,onFocus:Ne,onBlur:Ve,onClear:Pe,onKeydown:[B(ve(_=>W(c.value-1),["prevent"]),["up"]),B(ve(_=>W(c.value+1),["prevent"]),["down"]),B(re,["enter"]),B(D,["tab"]),B(Fe,["esc"])],onMousedown:De}),Ye({_:2},[a.$slots.prepend?{name:"prepend",fn:x(()=>[T(a.$slots,"prepend")])}:void 0,a.$slots.append?{name:"append",fn:x(()=>[T(a.$slots,"append")])}:void 0,a.$slots.prefix?{name:"prefix",fn:x(()=>[T(a.$slots,"prefix")])}:void 0,a.$slots.suffix?{name:"suffix",fn:x(()=>[T(a.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","append-to","transition"]))}});var Et=ze(At,[["__file","autocomplete.vue"]]);const St=at(Et);function kt(t,e){let s;const l=b(!1),o=st({...t,originalPosition:"",originalOverflow:"",visible:!1});function r(u){o.text=u}function p(){const u=o.parent,v=y.ns;if(!u.vLoadingAddClassList){let c=u.getAttribute("loading-number");c=Number.parseInt(c)-1,c?u.setAttribute("loading-number",c.toString()):(z(u,v.bm("parent","relative")),u.removeAttribute("loading-number")),z(u,v.bm("parent","hidden"))}n(),h.unmount()}function n(){var u,v;(v=(u=y.$el)==null?void 0:u.parentNode)==null||v.removeChild(y.$el)}function i(){var u;t.beforeClose&&!t.beforeClose()||(l.value=!0,clearTimeout(s),s=setTimeout(f,400),o.visible=!1,(u=t.closed)==null||u.call(t))}function f(){if(!l.value)return;const u=o.parent;l.value=!1,u.vLoadingAddClassList=void 0,p()}const d=Q({name:"ElLoading",setup(u,{expose:v}){const{ns:c,zIndex:O}=ot("loading");return v({ns:c,zIndex:O}),()=>{const w=o.spinner||o.svg,k=N("svg",{class:"circular",viewBox:o.svgViewBox?o.svgViewBox:"0 0 50 50",...w?{innerHTML:w}:{}},[N("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),A=o.text?N("p",{class:c.b("text")},[o.text]):void 0;return N(rt,{name:c.b("fade"),onAfterLeave:f},{default:x(()=>[Ce($("div",{style:{backgroundColor:o.background||""},class:[c.b("mask"),o.customClass,o.fullscreen?"is-fullscreen":""]},[N("div",{class:c.b("spinner")},[k,A])]),[[nt,o.visible]])])})}}}),h=lt(d);Object.assign(h._context,e??{});const y=h.mount(document.createElement("div"));return{...ee(o),setText:r,removeElLoadingChild:n,close:i,handleAfterLeave:f,vm:y,get $el(){return y.$el}}}let K;const ae=function(t={}){if(!ut)return;const e=Lt(t);if(e.fullscreen&&K)return K;const s=kt({...e,closed:()=>{var o;(o=e.closed)==null||o.call(e),e.fullscreen&&(K=void 0)}},ae._context);Tt(e,e.parent,s),he(e,e.parent,s),e.parent.vLoadingAddClassList=()=>he(e,e.parent,s);let l=e.parent.getAttribute("loading-number");return l?l=`${Number.parseInt(l)+1}`:l="1",e.parent.setAttribute("loading-number",l),e.parent.appendChild(s.$el),Ae(()=>s.visible.value=e.visible),e.fullscreen&&(K=s),s},Lt=t=>{var e,s,l,o;let r;return F(t.target)?r=(e=document.querySelector(t.target))!=null?e:document.body:r=t.target||document.body,{parent:r===document.body||t.body?document.body:r,background:t.background||"",svg:t.svg||"",svgViewBox:t.svgViewBox||"",spinner:t.spinner||!1,text:t.text||"",fullscreen:r===document.body&&((s=t.fullscreen)!=null?s:!0),lock:(l=t.lock)!=null?l:!1,customClass:t.customClass||"",visible:(o=t.visible)!=null?o:!0,beforeClose:t.beforeClose,closed:t.closed,target:r}},Tt=async(t,e,s)=>{const{nextZIndex:l}=s.vm.zIndex||s.vm._.exposed.zIndex,o={};if(t.fullscreen)s.originalPosition.value=V(document.body,"position"),s.originalOverflow.value=V(document.body,"overflow"),o.zIndex=l();else if(t.parent===document.body){s.originalPosition.value=V(document.body,"position"),await Ae();for(const r of["top","left"]){const p=r==="top"?"scrollTop":"scrollLeft";o[r]=`${t.target.getBoundingClientRect()[r]+document.body[p]+document.documentElement[p]-Number.parseInt(V(document.body,`margin-${r}`),10)}px`}for(const r of["height","width"])o[r]=`${t.target.getBoundingClientRect()[r]}px`}else s.originalPosition.value=V(e,"position");for(const[r,p]of Object.entries(o))s.$el.style[r]=p},he=(t,e,s)=>{const l=s.vm.ns||s.vm._.exposed.ns;["absolute","fixed","sticky"].includes(s.originalPosition.value)?z(e,l.bm("parent","relative")):ge(e,l.bm("parent","relative")),t.fullscreen&&t.lock?ge(e,l.bm("parent","hidden")):z(e,l.bm("parent","hidden"))};ae._context=null;const q=Symbol("ElLoading"),ye=(t,e)=>{var s,l,o,r;const p=e.instance,n=u=>J(e.value)?e.value[u]:void 0,i=u=>{const v=F(u)&&(p==null?void 0:p[u])||u;return v&&b(v)},f=u=>i(n(u)||t.getAttribute(`element-loading-${ct(u)}`)),d=(s=n("fullscreen"))!=null?s:e.modifiers.fullscreen,h={text:f("text"),svg:f("svg"),svgViewBox:f("svgViewBox"),spinner:f("spinner"),background:f("background"),customClass:f("customClass"),fullscreen:d,target:(l=n("target"))!=null?l:d?void 0:t,body:(o=n("body"))!=null?o:e.modifiers.body,lock:(r=n("lock"))!=null?r:e.modifiers.lock},y=ae(h);y._context=se._context,t[q]={options:h,instance:y}},It=(t,e)=>{for(const s of Object.keys(e))it(e[s])&&(e[s].value=t[s])},se={mounted(t,e){e.value&&ye(t,e)},updated(t,e){const s=t[q];e.oldValue!==e.value&&(e.value&&!e.oldValue?ye(t,e):e.value&&e.oldValue?J(e.value)&&It(e.value,s.options):s==null||s.instance.close())},unmounted(t){var e;(e=t[q])==null||e.instance.close(),t[q]=null}};se._context=null;const Dt={props:{tableData:{type:Array,Required:!0}},setup(t){const{tableData:e}=ee(t);return{reversedTableData:P(()=>[...e.value].reverse())}}};function Bt(t,e,s,l,o,r){const p=yt,n=_t;return C(),Z(n,{data:l.reversedTableData,stripe:"",height:"240"},{default:x(()=>[$(p,{prop:"comment",label:"Date"}),$(p,{prop:"chinese",label:"语文"}),$(p,{prop:"mathematics",label:"数学"}),$(p,{prop:"english",label:"英语"})]),_:1},8,["data"])}const Nt=te(Dt,[["render",Bt]]),Vt={props:{tableData:{type:Array,required:!0}},setup(t){const e=b(null),{tableData:s}=ee(t);let l=null;const o=()=>{const r=[],p=[],n=[],i=[];s.value.forEach(d=>{const h=new Date(d.exam_date),y=`${h.getFullYear()}.${h.getMonth()+1}`;r.push(y),p.push(d.chinese),n.push(d.mathematics),i.push(d.english)});const f={legend:{data:["语文","数学","英语"]},grid:{left:"1%",right:"1%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:r,axisLabel:{rotate:45,interval:0}},yAxis:{type:"value",minInterval:5,min:"dataMin"},series:[{name:"语文",type:"line",smooth:!0,data:p},{name:"数学",type:"line",smooth:!0,data:n},{name:"英语",type:"line",smooth:!0,data:i}]};l||(l=ft.init(e.value)),l.setOption(f)};return X(()=>{o()}),$e(()=>{l&&l.dispose()}),dt(s,r=>{o()}),{chartDom:e}}},Pt={ref:"chartDom",style:{width:"100%",height:"270px","background-color":"#fafafa"}};function Ft(t,e,s,l,o,r){return C(),S("div",Pt,null,512)}const Ot=te(Vt,[["render",Ft]]),Rt={components:{tablereport:Nt,chartreport:Ot},setup(){const t=b(!0),e=b([]),s=b([]),l=b(""),o=async()=>{try{const n=await be.get("/user");Array.isArray(n)?s.value=n:console.warn("返回的数据格式不正确。")}catch(n){console.error("获取用户列表失败:",n),alert("获取用户失败，请检查网络或稍后再试。")}},r=(n,i)=>{const f=n?s.value.filter(d=>d.uname.toLowerCase().indexOf(n.toLowerCase())!==-1):s.value;i(f)},p=async n=>{var i,f;if(t.value=!0,!(n!=null&&n.uname)){alert("无效的选择，请重新选择。");return}try{const d=await be.get(`/exam/${n.uid}`);e.value=d.data&&Array.isArray(d.data)?d.data:[],t.value=!1}catch(d){const h=((f=(i=d.response)==null?void 0:i.data)==null?void 0:f.message)||d.message||"未知错误";alert(`获取数据失败: ${h}，请稍后再试。`)}};return X(o),{loading:t,reportList:e,state:l,querySearchAsync:r,handleSelect:p}}},Kt={key:0},Mt={key:1,style:{"text-align":"center"}};function qt(t,e,s,l,o,r){const p=St,n=me("tablereport"),i=me("chartreport"),f=vt,d=pt,h=se;return C(),S(we,null,[$(p,{modelValue:l.state,"onUpdate:modelValue":e[0]||(e[0]=y=>l.state=y),"value-key":"uname","fetch-suggestions":l.querySearchAsync,placeholder:"点击选择或直接输入姓名查询成绩",onSelect:l.handleSelect,style:{"min-width":"300px","max-width":"300px"}},null,8,["modelValue","fetch-suggestions","onSelect"]),l.reportList&&l.reportList.length?(C(),S("div",Kt,[Ce((C(),Z(f,{direction:"vertical",size:"large",fill:"",style:{"min-width":"99%"}},{default:x(()=>[$(n,{tableData:l.reportList},null,8,["tableData"]),$(i,{tableData:l.reportList},null,8,["tableData"])]),_:1})),[[h,l.loading]])])):(C(),S("div",Mt,[$(d,null,{default:x(()=>e[1]||(e[1]=[xe("暂无数据")])),_:1})]))],64)}const Gt=te(Rt,[["render",qt]]);export{Gt as default};
