import{g as ye,h as J,N as we,i as Ee,j as Se,U as N,k as M,I as U,C as te,l as $e,m as ae,p as Ae,q as _e,r as c,s as ke,c as T,v as Ce,x as Te,y as se,o as k,z as Ie,d as m,e as X,n as I,A as t,B as Y,b as v,a as B,D as S,E as Ne,G as Be,F as le,H as Ve,f as De,t as Fe,J as Le,K as _,L as Z,M as Pe,O as Oe,P as Ke,Q as R,R as Me,S as Re,_ as Ue,T as ee}from"./index-CGUvE740.js";import{u as We,d as qe,c as xe,E as He,a as ze,b as Ge}from"./el-input-C_7dhoOy.js";import{u as je}from"./use-form-item-BReMi4bs.js";const Qe=ye({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:J(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:J([Function,Array]),default:we},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ee.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...Se(["ariaLabel"])}),Je={[N]:n=>M(n),[U]:n=>M(n),[te]:n=>M(n),focus:n=>n instanceof FocusEvent,blur:n=>n instanceof FocusEvent,clear:()=>!0,select:n=>$e(n)},oe="ElAutocomplete",Xe=ae({name:oe,inheritAttrs:!1}),Ye=ae({...Xe,props:Qe,emits:Je,setup(n,{expose:g,emit:i}){const s=n,V=We(),D=Ae(),r=je(),a=_e("autocomplete"),l=c(),d=c(),b=c(),W=c();let q=!1,F=!1;const f=c([]),u=c(-1),x=c(""),h=c(!1),C=c(!1),w=c(!1),$=ke(),ne=T(()=>D.style),y=T(()=>(f.value.length>0||w.value)&&h.value),H=T(()=>!s.hideLoading&&w.value),re=T(()=>l.value?Array.from(l.value.$el.querySelectorAll("input")):[]),ue=()=>{y.value&&(x.value=`${l.value.$el.offsetWidth}px`)},ie=()=>{u.value=-1},z=qe(async e=>{if(C.value)return;const o=p=>{w.value=!1,!C.value&&(R(p)?(f.value=p,u.value=s.highlightFirstItem?0:-1):Me(oe,"autocomplete suggestions must be an array"))};if(w.value=!0,R(s.fetchSuggestions))o(s.fetchSuggestions);else{const p=await s.fetchSuggestions(e,o);R(p)&&o(p)}},s.debounce),ce=e=>{const o=!!e;if(i(U,e),i(N,e),C.value=!1,h.value||(h.value=o),!s.triggerOnFocus&&!e){C.value=!0,f.value=[];return}z(e)},pe=e=>{var o;r.value||(((o=e.target)==null?void 0:o.tagName)!=="INPUT"||re.value.includes(document.activeElement))&&(h.value=!0)},de=e=>{i(te,e)},fe=e=>{F?F=!1:(h.value=!0,i("focus",e),s.triggerOnFocus&&!q&&z(String(s.modelValue)))},ve=e=>{setTimeout(()=>{var o;if((o=b.value)!=null&&o.isFocusInsideContent()){F=!0;return}h.value&&A(),i("blur",e)})},ge=()=>{h.value=!1,i(N,""),i("clear")},G=async()=>{y.value&&u.value>=0&&u.value<f.value.length?L(f.value[u.value]):s.selectWhenUnmatched&&(i("select",{value:s.modelValue}),f.value=[],u.value=-1)},he=e=>{y.value&&(e.preventDefault(),e.stopPropagation(),A())},A=()=>{h.value=!1},me=()=>{var e;(e=l.value)==null||e.focus()},be=()=>{var e;(e=l.value)==null||e.blur()},L=async e=>{i(U,e[s.valueKey]),i(N,e[s.valueKey]),i("select",e),f.value=[],u.value=-1},P=e=>{if(!y.value||w.value)return;if(e<0){u.value=-1;return}e>=f.value.length&&(e=f.value.length-1);const o=d.value.querySelector(`.${a.be("suggestion","wrap")}`),E=o.querySelectorAll(`.${a.be("suggestion","list")} li`)[e],O=o.scrollTop,{offsetTop:Q,scrollHeight:K}=E;Q+K>O+o.clientHeight&&(o.scrollTop+=K),Q<O&&(o.scrollTop-=K),u.value=e,l.value.ref.setAttribute("aria-activedescendant",`${$.value}-item-${u.value}`)},j=Ce(W,()=>{y.value&&A()});return Te(()=>{j==null||j()}),se(()=>{l.value.ref.setAttribute("role","textbox"),l.value.ref.setAttribute("aria-autocomplete","list"),l.value.ref.setAttribute("aria-controls","id"),l.value.ref.setAttribute("aria-activedescendant",`${$.value}-item-${u.value}`),q=l.value.ref.hasAttribute("readonly")}),g({highlightedIndex:u,activated:h,loading:w,inputRef:l,popperRef:b,suggestions:f,handleSelect:L,handleKeyEnter:G,focus:me,blur:be,close:A,highlight:P}),(e,o)=>(k(),Ie(t(Oe),{ref_key:"popperRef",ref:b,visible:t(y),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(a).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(a).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ue,onHide:ie},{content:m(()=>[X("div",{ref_key:"regionRef",ref:d,class:I([t(a).b("suggestion"),t(a).is("loading",t(H))]),style:Y({[e.fitInputWidth?"width":"minWidth"]:x.value,outline:"none"}),role:"region"},[v(t(xe),{id:t($),tag:"ul","wrap-class":t(a).be("suggestion","wrap"),"view-class":t(a).be("suggestion","list"),role:"listbox"},{default:m(()=>[t(H)?(k(),B("li",{key:0},[S(e.$slots,"loading",{},()=>[v(t(Ne),{class:I(t(a).is("loading"))},{default:m(()=>[v(t(Be))]),_:1},8,["class"])])])):(k(!0),B(le,{key:1},Ve(f.value,(p,E)=>(k(),B("li",{id:`${t($)}-item-${E}`,key:E,class:I({highlighted:u.value===E}),role:"option","aria-selected":u.value===E,onClick:O=>L(p)},[S(e.$slots,"default",{item:p},()=>[De(Fe(p[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:m(()=>[X("div",{ref_key:"listboxRef",ref:W,class:I([t(a).b(),e.$attrs.class]),style:Y(t(ne)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(y),"aria-owns":t($)},[v(t(He),Le({ref_key:"inputRef",ref:l},t(V),{clearable:e.clearable,disabled:t(r),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ce,onChange:de,onFocus:fe,onBlur:ve,onClear:ge,onKeydown:[_(Z(p=>P(u.value-1),["prevent"]),["up"]),_(Z(p=>P(u.value+1),["prevent"]),["down"]),_(G,["enter"]),_(A,["tab"]),_(he,["esc"])],onMousedown:pe}),Pe({_:2},[e.$slots.prepend?{name:"prepend",fn:m(()=>[S(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:m(()=>[S(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:m(()=>[S(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:m(()=>[S(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Ze=Ke(Ye,[["__file","autocomplete.vue"]]);const et=Re(Ze),tt={setup(){const n=c([]),g=c([]),i=c("");return se(async()=>{try{const r=await ee.get("/user");Array.isArray(r)?g.value=r:console.warn("返回的数据格式不正确。")}catch(r){console.error("获取链接失败:",r)}}),{reportList:n,links:g,state:i,querySearchAsync:(r,a)=>{if(!r){a(g.value);return}const l=r.toLowerCase(),d=g.value.filter(b=>b.value.toLowerCase().startsWith(l));a(d)},handleSelect:async r=>{var a,l;if(!r||!r.link){alert("无效的选择，请重新选择。");return}try{const d=await ee.get(`/exam?user=${r.link}`);n.value=d.data||[]}catch(d){const b=((l=(a=d.response)==null?void 0:a.data)==null?void 0:l.message)||d.message||"未知错误";alert(`获取数据失败: ${b}，请稍后再试。`)}}}}};function at(n,g,i,s,V,D){const r=et,a=Ge,l=ze;return k(),B(le,null,[v(r,{modelValue:s.state,"onUpdate:modelValue":g[0]||(g[0]=d=>s.state=d),"value-key":"uname","fetch-suggestions":s.querySearchAsync,placeholder:"点击选择或直接输入姓名查询成绩",onSelect:s.handleSelect,style:{"min-width":"300px","max-width":"300px"}},null,8,["modelValue","fetch-suggestions","onSelect"]),v(l,{data:s.reportList,height:"300",stripe:"",style:{"max-width":"1000px"}},{default:m(()=>[v(a,{prop:"ExamDate",label:"Date"}),v(a,{prop:"Chinese",label:"语文"}),v(a,{prop:"Mathematics",label:"数学"}),v(a,{prop:"English",label:"英语"})]),_:1},8,["data"])],64)}const rt=Ue(tt,[["render",at]]);export{rt as default};
